<!DOCTYPE html>
<html lang="en-us">
    <head>
        

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Estimating hiking velocity with rHike</title>
        
        <style>

    html body {
        font-family: 'Raleway', sans-serif;
        background-color: white;
    }

    :root {
        --accent: #CC0000;
        --border-width:  5px ;
    }

</style>


<link rel="stylesheet" href="/css/main.css">





<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">


 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"> 


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">


<link rel="stylesheet" href="https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css">
 

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/kotlin.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/scala.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/swift.min.js"></script>
    
    <script>hljs.initHighlightingOnLoad();</script>






<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<script>$(document).on('click', function() { $('.collapse').collapse('hide'); })</script>
 <meta name="generator" content="Hugo 0.63.1" />
        

        

        
            <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        

        

    </head>

    <body>
        

        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand" href="/">Kenneth Blake Vernon</a>
                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <div class="collapse navbar-collapse">
                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="/publications/">Publications</a></li>
                            
                                <li><a href="/post/">Posts</a></li>
                            
                                <li><a href="/research/">Research</a></li>
                            
                                <li><a href="/vitae/">Vitae</a></li>
                            
                        </ul>
                    
                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="mailto:kenneth.b.vernon@utah.edu" target="_blank"><i class="fa fa-envelope-o"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://github.com/kbvernon/" target="_blank"><i class="fa fa-github"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://orcid.org/0000-0003-0098-5092" target="_blank"><i class="ai ai-orcid"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://scholar.google.com/citations?user=2PE4za4AAAAJ&amp;hl=en" target="_blank"><i class="ai ai-google-scholar"></i></a></li>
                            
                                <li class="navbar-icon"><a href="/additional_files/blake_vitae.pdf" target="_blank"><i class="ai ai-cv"></i></a></li>
                            
                        </ul>
                    
                </div>
            </div>
        </nav>


<main>

    <div>
        <h2>Estimating hiking velocity with rHike</h2>
        <h5>April 13, 2020</h5>
        
<a href="/tags/r"><kbd class="item-tag">r</kbd></a>

<a href="/tags/sf"><kbd class="item-tag">sf</kbd></a>

<a href="/tags/gdistance"><kbd class="item-tag">gdistance</kbd></a>

<a href="/tags/rhike"><kbd class="item-tag">rHike</kbd></a>


    </div>

    <div align="start" class="content">
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>I wanted to learn how to write an R package and I had this recurrent use-case (estimating cost-distance on a grid), so I made <a href="https://github.com/kbvernon/rHike"><code>rHike</code></a>. It’s a super-lightweight package that builds on Jacob van Etten’s <a href="https://agrobioinfoservices.github.io/gdistance/"><code>gdistance</code></a> by implementing both Tobler’s (1993) and Campbell’s (2019) hiking functions, though others could be added. Mainly, it just simplifies the user interface.</p>
<p>Development mostly followed the workflow suggested by Hadley Wickham and Jenny Bryan in their <a href="https://r-pkgs.org/">R Packages</a> book. Mostly…</p>
<p><code>rHike</code> is not currently on CRAN, but you can install from Github with the following code:</p>
<pre class="r"><code># install.packages(&quot;devtools&quot;)
devtools::install_github(&quot;kbvernon/rHike&quot;)</code></pre>
<p><br></p>
<p><em>Where we are going</em></p>
<p>Campbell’s Hiking Function is an amended version of the Laplace distribution:</p>
<p><span class="math display">\[f(x) = \frac{c}{2b}\, exp\left(\frac{|x - a|}{b}\right) + d + e\, x\]</span></p>
<p>where <span class="math inline">\(x\)</span> is the slope at a location measured in degrees. This equation reflects the intuitive notion that walking speed varies as a function of slope.</p>
<pre class="r"><code>slope &lt;- seq(-50, 50, by = 1)

velocity &lt;- hf_campbell(slope, decile = 10)</code></pre>
<p><img src="/post/2020-04-13-calculating-cost-distance-with-rhike_files/figure-html/unnamed-chunk-2-1.png" width="384" style="display: block; margin: auto;" /></p>
<p><br></p>
<hr />
<div id="r-preamble" class="section level4">
<h4>R Preamble</h4>
<pre class="r"><code>library(gdistance)
library(raster)
library(rHike)
library(sf)
library(tidyverse)
library(viridis)</code></pre>
<p><br></p>
<p>Coordinate Reference System (CRS):</p>
<pre class="r"><code>crs_utm12 &lt;- &quot;+init=epsg:26912 +proj=utm +zone=12 +datum=NAD83 +units=m +no_defs&quot;</code></pre>
<p><br></p>
<p>It should really be emphasized that</p>
<blockquote>
<p>the unit of projection should match the unit of the stored values.</p>
</blockquote>
<p>In this case, elevation is in meters, so the projection should be in meters too.</p>
<p><br></p>
</div>
<div id="data-wrangling" class="section level4">
<h4>Data Wrangling</h4>
<p>First, we read in a DEM of the foothills in Salt Lake City, Utah:</p>
<pre class="r"><code>dem &lt;- raster(system.file(&quot;extdata/slc.tif&quot;, package = &quot;rHike&quot;))

dem &lt;- projectRaster(dem, crs = crs_utm12)</code></pre>
<p><br></p>
<p>Next we generate a random point pattern within it.</p>
<pre class="r"><code>project_window &lt;- dem %&gt;% 
  raster::extent() %&gt;% 
  as(&quot;SpatialPolygons&quot;) %&gt;% 
  st_as_sf() %&gt;% 
  st_cast()

random_points &lt;- st_sample(project_window, size = 5)</code></pre>
<p><br></p>
<p><img src="/post/2020-04-13-calculating-cost-distance-with-rhike_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br></p>
<p>Now we use the elevation data to generate a slope raster and calculate a velocity surface for the average hiker using Campbell’s Hiking Function.</p>
<pre class="r"><code>slope &lt;- hf_slope(dem)

velocity &lt;- hf_velocity(slope, fun = &quot;campbell&quot;, decile = 10)</code></pre>
<p><br></p>
<p><img src="/post/2020-04-13-calculating-cost-distance-with-rhike_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br></p>
</div>
<div id="calculating-cost-distance" class="section level4">
<h4>Calculating Cost-Distance</h4>
<p>Accumulated cost-distance is the total time it takes to travel from one location to another; in this case, to <em>all</em> other locations in the landscape of interest.</p>
<pre class="r"><code>cost &lt;- hf_costDistance(velocity, 
                        fun = function(x) 1/mean(x), 
                        points = random_points)

# convert seconds to minutes
cost &lt;- cost/60</code></pre>
<p><br></p>
<p><img src="/post/2020-04-13-calculating-cost-distance-with-rhike_files/figure-html/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br></p>
<p>That looks about right, twenty or so minutes for the average hiker to walk a half-mile or so around the SLC foothills.</p>
<p><br></p>
</div>
<div id="future-work" class="section level4">
<h4>Future Work</h4>
<p>In this post, conversion between different units was done on the fly. It would be nice to introduce methods to do that in a more rigorous way, so I might look into integrating the <a href="https://r-quantities.github.io/units/"><code>units</code></a> package at some point.</p>
<p><br></p>
</div>
<div id="references" class="section level4">
<h4><strong>References</strong></h4>
<p>Tobler, Waldo R. (1993). “Three Presentations on Geographical Analysis and Modeling: Non-Isotropic Geographic Modeling, Speculations
on the Geometry of Geography, and Global Spatial Analysis.”  93-1.</p>
<p>Campbell, Michael J., Philip E. Dennison, Bret W. Butler, and Wesley G. Page (2019). "Using crowdsourced fitness tracker data
to model the relationship between slope and travel rates.  106, 93-107.</p>
</div>
</div>

    
    
    
        <h4 class="page-header">Related</h4>
         <div class="item">

    
    
    

    
    

    <h4><a href="/post/plotting-fieldwork-with-mapview/">Plotting fieldwork with mapview</a></h4>
    <h5>April 7, 2020</h5>
    
<a href="/tags/r"><kbd class="item-tag">r</kbd></a>

<a href="/tags/sf"><kbd class="item-tag">sf</kbd></a>

<a href="/tags/mapview"><kbd class="item-tag">mapview</kbd></a>

<a href="/tags/fieldwork"><kbd class="item-tag">fieldwork</kbd></a>



</div>
 
    

    
    

</main>

        <footer>
            <p class="copyright text-muted">© 2020 Kenneth B. Vernon. Powered by <a href="https://gohugo.io">Hugo</a> and <a href="https://github.com/calintat/minimal">Minimal</a>.</p>
        </footer>

        

        
    </body>

</html>

